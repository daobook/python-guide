
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh_CN">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>HTML Scraping &#8212; The Hitchhiker&#39;s Guide to Python</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Command-line Applications" href="cli.html" />
    <link rel="prev" title="Web Applications &amp; Frameworks" href="web.html" />
  

  

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    div.body {
      min-width: initial;
      max-width: initial;
    }
  </style>

  
  <link rel="canonical" href="https://docs.python-guide.org/scenarios/scrape/"/>
  <meta property="og:url" content="https://docs.python-guide.org/scenarios/scrape">
  

  <link rel="icon" type="image/png" href="https://media.readthedocs.org/images/favicon.png">

  <meta name="google-site-verification" content="013PxE2_8KX9jdUSC5gr8QsfdxTXr1mFgmD9zplp5II" />

  <meta name="twitter:card" content="summary">
  <meta property="twitter:image" content="https://docs.python-guide.org/_static/social-card.jpg">
  <meta property="og:image" content="https://docs.python-guide.org/_static/social-card.jpg">
  <meta property="og:title" content="HTML Scraping &#8212; The Hitchhiker&#39;s Guide to Python">
  <meta property="og:type" content="article">
  
  <meta property="og:description" content="">

  <script>window.rp_prop_id = '29182759436';</script>
  <script src="https://srv.realpython.net/tag.js" async></script>

  <script src="https://d31vxm9ubutrmw.cloudfront.net/static/js/2169.js"></script>

  
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-37242602-11', 'auto');
    ga('send', 'pageview');
    </script>

  </head><body>

  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            <div style="display:block;position:relative; margin-bottom: 1em;">
              <div style="display:block;width:100%;padding-top:12.5%;"></div>
              <div class="rpad" data-unit="8x1" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;"></div>
            </div>
            
  <div class="section" id="html-scraping">
<h1>HTML Scraping<a class="headerlink" href="#html-scraping" title="永久链接至标题">¶</a></h1>
<img alt="../_images/34268661876_442428e122_k_d.jpg" src="../_images/34268661876_442428e122_k_d.jpg" />
<div class="section" id="web-scraping">
<h2>Web Scraping<a class="headerlink" href="#web-scraping" title="永久链接至标题">¶</a></h2>
<p>Web sites are written using HTML, which means that each web page is a
structured document. Sometimes it would be great to obtain some data from
them and preserve the structure while we’re at it. Web sites don’t always
provide their data in comfortable formats such as CSV or JSON.</p>
<p>This is where web scraping comes in. Web scraping is the practice of using a
computer program to sift through a web page and gather the data that you need
in a format most useful to you while at the same time preserving the structure
of the data.</p>
</div>
<div class="section" id="lxml-and-requests">
<h2>lxml and Requests<a class="headerlink" href="#lxml-and-requests" title="永久链接至标题">¶</a></h2>
<p><a class="reference external" href="http://lxml.de/">lxml</a> is a pretty extensive library written for parsing
XML and HTML documents very quickly, even handling messed up tags in the
process. We will also be using the
<a class="reference external" href="http://docs.python-requests.org/en/latest/">Requests</a> module instead of the
already built-in urllib2 module due to improvements in speed and readability.
You can easily install both using <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">lxml</span></code> and
<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">requests</span></code>.</p>
<p>Let’s start with the imports:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">html</span>
<span class="kn">import</span> <span class="nn">requests</span>
</pre></div>
</div>
<p>Next we will use <code class="docutils literal notranslate"><span class="pre">requests.get</span></code> to retrieve the web page with our data,
parse it using the <code class="docutils literal notranslate"><span class="pre">html</span></code> module, and save the results in <code class="docutils literal notranslate"><span class="pre">tree</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://econpy.pythonanywhere.com/ex/001.html&#39;</span><span class="p">)</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
<p>(We need to use <code class="docutils literal notranslate"><span class="pre">page.content</span></code> rather than <code class="docutils literal notranslate"><span class="pre">page.text</span></code> because
<code class="docutils literal notranslate"><span class="pre">html.fromstring</span></code> implicitly expects <code class="docutils literal notranslate"><span class="pre">bytes</span></code> as input.)</p>
<p><code class="docutils literal notranslate"><span class="pre">tree</span></code> now contains the whole HTML file in a nice tree structure which
we can go over two different ways: XPath and CSSSelect. In this example, we
will focus on the former.</p>
<p>XPath is a way of locating information in structured documents such as
HTML or XML documents. A good introduction to XPath is on
<a class="reference external" href="http://www.w3schools.com/xml/xpath_intro.asp">W3Schools</a> .</p>
<p>There are also various tools for obtaining the XPath of elements such as
FireBug for Firefox or the Chrome Inspector. If you’re using Chrome, you
can right click an element, choose ‘Inspect element’, highlight the code,
right click again, and choose ‘Copy XPath’.</p>
<p>After a quick analysis, we see that in our page the data is contained in
two elements – one is a div with title ‘buyer-name’ and the other is a
span with class ‘item-price’:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">title</span><span class="o">=</span><span class="s">&quot;buyer-name&quot;</span><span class="p">&gt;</span>Carson Busses<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;item-price&quot;</span><span class="p">&gt;</span>$29.95<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Knowing this we can create the correct XPath query and use the lxml
<code class="docutils literal notranslate"><span class="pre">xpath</span></code> function like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#This will create a list of buyers:</span>
<span class="n">buyers</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@title=&quot;buyer-name&quot;]/text()&#39;</span><span class="p">)</span>
<span class="c1">#This will create a list of prices</span>
<span class="n">prices</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//span[@class=&quot;item-price&quot;]/text()&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s see what we got exactly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s1">&#39;Buyers: &#39;</span><span class="p">,</span> <span class="n">buyers</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Prices: &#39;</span><span class="p">,</span> <span class="n">prices</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Buyers</span><span class="p">:</span>  <span class="p">[</span><span class="s1">&#39;Carson Busses&#39;</span><span class="p">,</span> <span class="s1">&#39;Earl E. Byrd&#39;</span><span class="p">,</span> <span class="s1">&#39;Patty Cakes&#39;</span><span class="p">,</span>
<span class="s1">&#39;Derri Anne Connecticut&#39;</span><span class="p">,</span> <span class="s1">&#39;Moe Dess&#39;</span><span class="p">,</span> <span class="s1">&#39;Leda Doggslife&#39;</span><span class="p">,</span> <span class="s1">&#39;Dan Druff&#39;</span><span class="p">,</span>
<span class="s1">&#39;Al Fresco&#39;</span><span class="p">,</span> <span class="s1">&#39;Ido Hoe&#39;</span><span class="p">,</span> <span class="s1">&#39;Howie Kisses&#39;</span><span class="p">,</span> <span class="s1">&#39;Len Lease&#39;</span><span class="p">,</span> <span class="s1">&#39;Phil Meup&#39;</span><span class="p">,</span>
<span class="s1">&#39;Ira Pent&#39;</span><span class="p">,</span> <span class="s1">&#39;Ben D. Rules&#39;</span><span class="p">,</span> <span class="s1">&#39;Ave Sectomy&#39;</span><span class="p">,</span> <span class="s1">&#39;Gary Shattire&#39;</span><span class="p">,</span>
<span class="s1">&#39;Bobbi Soks&#39;</span><span class="p">,</span> <span class="s1">&#39;Sheila Takya&#39;</span><span class="p">,</span> <span class="s1">&#39;Rose Tattoo&#39;</span><span class="p">,</span> <span class="s1">&#39;Moe Tell&#39;</span><span class="p">]</span>

<span class="n">Prices</span><span class="p">:</span>  <span class="p">[</span><span class="s1">&#39;$29.95&#39;</span><span class="p">,</span> <span class="s1">&#39;$8.37&#39;</span><span class="p">,</span> <span class="s1">&#39;$15.26&#39;</span><span class="p">,</span> <span class="s1">&#39;$19.25&#39;</span><span class="p">,</span> <span class="s1">&#39;$19.25&#39;</span><span class="p">,</span>
<span class="s1">&#39;$13.99&#39;</span><span class="p">,</span> <span class="s1">&#39;$31.57&#39;</span><span class="p">,</span> <span class="s1">&#39;$8.49&#39;</span><span class="p">,</span> <span class="s1">&#39;$14.47&#39;</span><span class="p">,</span> <span class="s1">&#39;$15.86&#39;</span><span class="p">,</span> <span class="s1">&#39;$11.11&#39;</span><span class="p">,</span>
<span class="s1">&#39;$15.98&#39;</span><span class="p">,</span> <span class="s1">&#39;$16.27&#39;</span><span class="p">,</span> <span class="s1">&#39;$7.50&#39;</span><span class="p">,</span> <span class="s1">&#39;$50.85&#39;</span><span class="p">,</span> <span class="s1">&#39;$14.26&#39;</span><span class="p">,</span> <span class="s1">&#39;$5.68&#39;</span><span class="p">,</span>
<span class="s1">&#39;$15.00&#39;</span><span class="p">,</span> <span class="s1">&#39;$114.07&#39;</span><span class="p">,</span> <span class="s1">&#39;$10.09&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Congratulations! We have successfully scraped all the data we wanted from
a web page using lxml and Requests. We have it stored in memory as two
lists. Now we can do all sorts of cool stuff with it: we can analyze it
using Python or we can save it to a file and share it with the world.</p>
<p>Some more cool ideas to think about are modifying this script to iterate
through the rest of the pages of this example dataset, or rewriting this
application to use threads for improved speed.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/python-guide-logo.png" title="The Hitchhiker's Guide to Python"/>
  </a>
</p>

<p style="margin-left:auto; margin-right: auto;"><iframe src="https://ghbtns.com/github-btn.html?user=realpython&repo=python-guide&type=watch&count=true&size=large" allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe></p>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
<style>
.algolia-autocomplete{
  width: 100%;
  height: 1.5em
}
.algolia-autocomplete a{
  border-bottom: none !important;
}
#doc_search{
  width: 100%;
  height: 100%;
}
</style>
<input id="doc_search" placeholder="Search the doc" autofocus/>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js" onload="docsearch({
  apiKey: '512b0d6c0c8578bed7662f5279c2249c',
  indexName: 'python-guide',
  inputSelector: '#doc_search',
  debug: false // Set debug to true if you want to inspect the dropdown
})" async></script>

<p>
  This opinionated guide exists to provide both novice and expert Python developers a best practice handbook to the installation, configuration, and usage of Python on a daily basis.
</p>

<div style="display:block;position:relative;margin: 1em 0 1em 0;">
  <div style="display:block;width:100%;padding-top:100%;"></div>
  <div class="rpad" data-unit="1x1" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;"></div>
</div>

<h3>O'Reilly Book</h3>

<p>This guide is now available in tangible book form!</p>

<p><a href="/guide-book" target="_blank"><img style="max-width: 100%; text-align: center;" src="/_static/guide-book-cover.jpg" alt="Python Guide Book Cover"></a></p>

<p>All proceeds are being directly donated to the <a href="https://djangogirls.org">DjangoGirls</a> organization.</p>

<h3>Translations</h3>
<ul>
  <li><a href="https://docs.python-guide.org/">English</a></li>
  <li><a href="https://python-guide-fr.readthedocs.io/fr/latest/">French</a></li>
  <li><a href="https://pythonguidecn.readthedocs.io/zh/latest/">Chinese</a></li>
  <li><a href="http://python-guideja.readthedocs.io/ja/latest/">Japanese</a></li>
  <li><a href="https://python-guide-kr.readthedocs.io/ko/latest/">Korean</a></li>
  <li><a href="http://python-guide-fil.readthedocs.io/en/latest/">Filipino</a></li>
  <li><a href="http://python-guide-pt-br.readthedocs.io/pt_BR/latest/">Brazilian Portuguese</a></li>
</ul>
  <h3><a href="../index.html">內容目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">HTML Scraping</a><ul>
<li><a class="reference internal" href="#web-scraping">Web Scraping</a></li>
<li><a class="reference internal" href="#lxml-and-requests">lxml and Requests</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="web.html" title="上一章">Web Applications &amp; Frameworks</a></li>
      <li>Next: <a href="cli.html" title="下一章">Command-line Applications</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="转向" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><!-- Alabaster (krTheme++) Hacks -->
        </div>
      </div>
      <div class="clearer"></div>
    </div>
<div class="footer">
  <div style="text-align: center;" id="waldo-tag-2171"></div>
  <p>&copy;2011-2021 <a href="https://www.kennethreitz.org/projects">Kenneth Reitz</a> &amp; <a href="https://realpython.com">Real Python</a>. <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">CC BY-NC-SA 3.0</a></p>
</div>

  </body>
</html>